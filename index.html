<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ - Ø¯Ø±ÙˆØ³ Ù…Ø¹ ØµÙØ­Ø§Øª ÙØ±Ø¹ÙŠØ©</title>
  <meta name="theme-color" content="#0aa2b8" />
  <style>
    :root {
      --bg1: #121423; --bg2: #1a1d2f;
      --glass: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.18);
      --accent: #0aa2b8; --accent-2: #4caf50; --danger: #b00020;
      --text: #e9f1f7; --muted: #a9b7c6;
      --code-bg: #0e1217; --code-txt: #b5f5ff;
    }
    * { box-sizing: border-box }
    body {
      margin: 0; color: var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", "Cairo", sans-serif;
      background:
        radial-gradient(1000px 500px at 10% 10%, #0e6788 0%, transparent 55%),
        radial-gradient(900px 450px at 90% 90%, #5a2a8a 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height: 100dvh;
    }
    header {
      position: sticky; top: 0; z-index: 100;
      backdrop-filter: blur(12px);
      background: var(--glass);
      border-bottom: 1px solid var(--border);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px }
    .brand { display: flex; align-items: center; gap: 12px }
    .logo {
      width: 42px; height: 42px; border-radius: 12px;
      background: linear-gradient(180deg,#12c2e9,#0aa2b8);
      display: grid; place-items: center; color: #032a33; font-weight: 900;
      box-shadow: 0 8px 24px rgba(18,194,233,0.25);
    }
    h1 { margin: 0; font-size: 1.35rem }
    nav { margin-top: 8px; display: flex; gap: 10px; flex-wrap: wrap }
    .nav-link {
      color: var(--text); text-decoration: none;
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid var(--border); background: rgba(255,255,255,0.06);
      font-size: .9rem;
    }
    .nav-link.active { background: var(--accent); border-color: transparent }
    main { padding: 18px 0 }
    .grid { display: grid; gap: 18px; grid-template-columns: 1fr }
    @media (min-width: 980px) { .grid { grid-template-columns: 2fr 1fr } }
    section.card {
      background: var(--glass); backdrop-filter: blur(16px);
      border: 1px solid var(--border); border-radius: 18px; padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    section.card h2 { margin: 0 0 12px 0; font-size: 1.2rem; display: flex; align-items: center; gap: 8px }
    p { color: var(--muted); line-height: 1.7 }
    video, .media { width: 100%; border-radius: 14px; overflow: hidden; border: 1px solid var(--border) }
    .lessons-grid { display: grid; gap: 14px; grid-template-columns: 1fr; }
    @media (min-width: 700px) { .lessons-grid { grid-template-columns: 1fr 1fr } }
    .lesson-card {
      background: rgba(255,255,255,0.07); border: 1px solid var(--border); border-radius: 14px;
      padding: 14px; display: flex; flex-direction: column; gap: 8px;
    }
    .lesson-card h3 { margin: 0; font-size: 1.05rem }
    .lesson-card .actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap }
    .pill {
      display: inline-block; padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,0.08); border: 1px solid var(--border);
      color: var(--muted); font-size: .85rem
    }
    .code { background: var(--code-bg); color: var(--code-txt); border-radius: 12px; padding: 12px; border: 1px solid #18202b; overflow: auto }
    pre { margin: 0; white-space: pre-wrap }
    textarea {
      width: 100%; min-height: 160px; background: var(--code-bg);
      color: #8cf5a8; font-family: ui-monospace, Menlo, Consolas, monospace;
      padding: 12px; border-radius: 12px; border: 1px solid #18202b;
    }
    .btns { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px }
    button {
      appearance: none; background: var(--accent); color: white; border: none; border-radius: 10px;
      padding: 10px 14px; cursor: pointer; font-weight: 600; box-shadow: 0 8px 20px rgba(10,162,184,0.35);
    }
    button.secondary { background: #2f3545 }
    button.success { background: var(--accent-2) }
    button.danger { background: var(--danger) }
    .alert {
      padding: 10px 12px; border-radius: 10px; background: rgba(76,175,80,.12);
      border: 1px solid rgba(76,175,80,.4); color: #b8f5c3; margin: 10px 0; display: none;
    }
    .install-banner { display: none; align-items: center; gap: 10px; margin: 10px 0; padding: 10px; border-radius: 12px; border: 1px dashed var(--border); background: rgba(255,255,255,0.06) }
    .kbd { font-family: ui-monospace, Menlo, Consolas, monospace; background: rgba(255,255,255,0.08); padding: 1px 6px; border-radius: 6px; border: 1px solid var(--border) }
    footer { margin-top: 18px; border-top: 1px solid var(--border); background: var(--glass); backdrop-filter: blur(12px) }
    .muted { color: var(--muted) }
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <div class="logo" id="dynamic-logo">A</div>
      <div>
        <h1>ØªØ¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ</h1>
        <div class="pill">ÙˆØ§Ø¬Ù‡Ø© Ø²Ø¬Ø§Ø¬ÙŠØ© â€¢ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ â€¢ Ø¯Ø±ÙˆØ³ Ø¨ØµÙØ­Ø§Øª ÙØ±Ø¹ÙŠØ© â€¢ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ«Ø¨ÙŠØª ÙƒØªØ·Ø¨ÙŠÙ‚</div>
        <nav>
          <a href="#/" class="nav-link" data-link="home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          <a href="#/lesson/1" class="nav-link" data-link="l1">Ø¯Ø±Ø³ 1</a>
          <a href="#/lesson/2" class="nav-link" data-link="l2">Ø¯Ø±Ø³ 2</a>
          <a href="#/lesson/3" class="nav-link" data-link="l3">Ø¯Ø±Ø³ 3</a>
          <a href="#/lesson/4" class="nav-link" data-link="l4">Ø¯Ø±Ø³ 4</a>
          <a href="#/lesson/5" class="nav-link" data-link="l5">Ø¯Ø±Ø³ 5</a>
          <a href="#/lesson/6" class="nav-link" data-link="l6">Ø¯Ø±Ø³ 6</a>
          <a href="#/lesson/7" class="nav-link" data-link="l7">Ø¯Ø±Ø³ 7</a>
          <a href="#/lesson/8" class="nav-link" data-link="l8">Ø¯Ø±Ø³ 8</a>
          <a href="#/lesson/9" class="nav-link" data-link="l9">Ø¯Ø±Ø³ 9</a>
          <a href="#/lesson/10" class="nav-link" data-link="l10">Ø¯Ø±Ø³ 10</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- ØµÙØ­Ø© Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <section class="card" id="homePage">
      <h2>ğŸ“š Ø§Ù„Ø¯Ø±ÙˆØ³</h2>
      <p class="muted">Ø§Ø®ØªÙØ± Ø¯Ø±Ø³Ù‹Ø§ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ù„Ù…. ÙƒÙ„ Ø¯Ø±Ø³ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆØŒ Ø´Ø±Ø­ØŒ Ù…Ø­Ø±Ø± ÙƒÙˆØ¯ Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ø§Ù…ØªØ­Ø§Ù† Ù…ØªØ§Ø¨Ø¹Ø©ØŒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©.</p>
      <div class="lessons-grid" id="lessonsList"></div>
    </section>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ÙØ±Ø¹ÙŠØ© -->
    <section class="card" id="lessonPage" style="display:none">
      <h2 id="lessonTitle">ğŸ“ Ø¯Ø±Ø³</h2>
      <div class="grid">
        <div>
          <h3>ğŸ¥ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¯Ø±Ø³</h3>
          <video class="media" controls id="lessonVideo">
            <source id="lessonVideoSrc" src="" type="video/mp4" />
            Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
          </video>
          <p id="lessonIntro" class="muted"></p>

          <h3>ğŸ’» ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯</h3>
          <textarea id="lessonEditor"></textarea>
          <div class="btns">
            <button id="runLessonBtn">ØªØ´ØºÙŠÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
            <button class="secondary" id="resetLessonBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
            <button class="success" id="saveLessonBtn">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù…</button>
            <button class="danger" id="clearLessonBtn">Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ÙÙˆØ¸</button>
          </div>
          <div id="lessonSavedAlert" class="alert">ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ âœ…</div>
          <div class="code" style="margin-top:10px">
            <pre id="lessonOutput">// Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</pre>
          </div>

          <h3>ğŸ“ Ø§Ù…ØªØ­Ø§Ù† Ù…ØªØ§Ø¨Ø¹Ø©</h3>
          <div id="quizContainer"></div>
          <div id="quizResult" class="alert">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
        </div>

        <div>
          <h3>ğŸ—’ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ</h3>
          <textarea id="notesArea" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ ÙˆØ£ÙÙƒØ§Ø±Ùƒ Ø­ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø³ Ù‡Ù†Ø§..."></textarea>
          <div class="btns">
            <button class="success" id="saveNotesBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
          </div>
          <div id="notesSavedAlert" class="alert">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ âœ…</div>

          <h3 style="margin-top:18px">ğŸ“¦ ØªØ«Ø¨ÙŠØª ÙƒØªØ·Ø¨ÙŠÙ‚</h3>
          <div class="install-banner" id="installBanner">
            <span>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ«Ø¨ÙŠØª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙƒØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</span>
            <button id="installBtn">ØªØ«Ø¨ÙŠØª</button>
          </div>
          <p class="muted">Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¹Ø¨Ø± http:// Ø£Ùˆ https:// Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„Ø®Ø¯Ù…Ø©.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <p class="muted">Â© ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ â€¢ ÙˆØ§Ø¬Ù‡Ø© Ø²Ø¬Ø§Ø¬ÙŠØ© â€¢ SPA â€¢ Ù…Ù„Ù ÙˆØ§Ø­Ø¯</p>
    </div>
  </footer>

  <script>
    // ========== 0) ØªÙˆÙ„ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ==========
    function generateIcon(size = 192) {
      const c = document.createElement('canvas'); c.width = size; c.height = size;
      const ctx = c.getContext('2d');
      const grd = ctx.createLinearGradient(0,0,size,size);
      grd.addColorStop(0, '#12c2e9'); grd.addColorStop(1, '#0aa2b8');
      ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(size/2, size/2, size/2 - 8, 0, Math.PI*2); ctx.fill();
      ctx.lineWidth = Math.max(8, size*0.06); ctx.strokeStyle = '#08343f';
      ctx.beginPath(); ctx.arc(size*0.38, size*0.5, size*0.16, 0, Math.PI*2); ctx.stroke();
      ctx.beginPath(); ctx.arc(size*0.62, size*0.5, size*0.16, 0, Math.PI*2); ctx.stroke();
      ctx.lineWidth = Math.max(6, size*0.045);
      ctx.beginPath();
      ctx.moveTo(size*0.38, size*0.43); ctx.lineTo(size*0.38, size*0.57);
      ctx.moveTo(size*0.31, size*0.5); ctx.lineTo(size*0.45, size*0.5);
      ctx.moveTo(size*0.62, size*0.43); ctx.lineTo(size*0.62, size*0.57);
      ctx.moveTo(size*0.55, size*0.5); ctx.lineTo(size*0.69, size*0.5);
      ctx.stroke();
      return c.toDataURL('image/png');
    }
    (function showMiniIcon(){
      const el = document.getElementById('dynamic-logo');
      const url = generateIcon(64);
      el.style.backgroundImage = `url(${url})`;
      el.style.backgroundSize = 'cover';
      el.textContent = '';
    })();

    // ========== 1) Ø¨ÙŠØ§Ù†Ø§Øª 10 Ø¯Ø±ÙˆØ³ ==========
    const lessons = [
      {
        id: 1,
        title: "Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆÙˆÙ…ÙŠØ¶ Ø§Ù„Ù„ÙŠØ¯",
        video: "lesson1.mp4",
        intro: "ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ù†ØµØ© Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†ÙˆØŒ ØªØ«Ø¨ÙŠØª Arduino IDEØŒ ÙˆØªØ¬Ø±Ø¨Ø© Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹: ÙˆÙ…ÙŠØ¶ Ø§Ù„Ù„ÙŠØ¯ Ø§Ù„Ù…Ø¯Ù…Ø¬.",
        defaultCode:
`// Blink LED
void setup() {
  pinMode(LED_BUILTIN, OUTPUT);
}
void loop() {
  digitalWrite(LED_BUILTIN, HIGH);
  delay(1000);
  digitalWrite(LED_BUILTIN, LOW);
  delay(1000);
}
`,
        quiz: [
          { q: "Ø£ÙŠ Ø¯Ø§Ù„Ø© ØªÙÙ†ÙÙ‘Ø° Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ØŸ", choices: ["setup()", "loop()"], answer: 0 },
          { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø³Ù…Ø§Ø± Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù„ÙŠØ¯ Ø§Ù„Ù…Ø¯Ù…Ø¬ØŸ", choices: ["LED_BUILTIN", "A0"], answer: 0 },
        ]
      },
      {
        id: 2,
        title: "Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©: Ø²Ø± Ø§Ù„Ø¶ØºØ·",
        video: "lesson2.mp4",
        intro: "Ù‚Ø±Ø§Ø¡Ø© Ø­Ø§Ù„Ø© Ø²Ø± Ø¶ØºØ· ÙˆØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…ÙŠ.",
        defaultCode:
`int button = 2;
void setup() {
  pinMode(button, INPUT_PULLUP);
  pinMode(LED_BUILTIN, OUTPUT);
}
void loop() {
  int pressed = digitalRead(button) == LOW;
  digitalWrite(LED_BUILTIN, pressed ? HIGH : LOW);
}
`,
        quiz: [
          { q: "Ù„Ù…Ø§Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù… INPUT_PULLUPØŸ", choices: ["Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù‚Ø§ÙˆÙ…Ø© Ø³Ø­Ø¨ Ø¯Ø§Ø®Ù„ÙŠØ©", "Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬"], answer: 0 },
          { q: "Ù…Ø§ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù†Ø¯ Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù…Ø¹ PullupØŸ", choices: ["LOW", "HIGH"], answer: 0 },
        ]
      },
      {
        id: 3,
        title: "Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„ØªÙ†Ø§Ø¸Ø±ÙŠØ©: Ø­Ø³Ø§Ø³ Ø¶ÙˆØ¦ÙŠ",
        video: "lesson3.mp4",
        intro: "Ø§Ø³ØªØ®Ø¯Ù… analogRead Ù„Ù‚Ø±Ø§Ø¡Ø© Ø­Ø³Ø§Ø³ Ø¶ÙˆØ¦ÙŠ Ø¹Ù„Ù‰ A0 ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù‚ÙŠÙ… Ø¹Ø¨Ø± Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ.",
        defaultCode:
`int sensor = A0;
void setup() { Serial.begin(9600); }
void loop() {
  int value = analogRead(sensor);
  Serial.println(value);
  delay(500);
}
`,
        quiz: [
          { q: "Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù€ analogRead Ø¹Ù„Ù‰ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ UnoØŸ", choices: ["0-1023", "0-255"], answer: 0 },
          { q: "Ø£ÙŠ Ø¯Ø§Ù„Ø© ØªØ·Ø¨Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØŸ", choices: ["Serial.println()", "pinMode()"], answer: 0 },
        ]
      },
      {
        id: 4,
        title: "PWM Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø³Ø·ÙˆØ¹",
        video: "lesson4.mp4",
        intro: "Ø§Ø³ØªØ®Ø¯Ù… analogWrite Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø³Ø·ÙˆØ¹ Ù„ÙŠØ¯ Ø¹Ù„Ù‰ Ù…Ø³Ù…Ø§Ø± ÙŠØ¯Ø¹Ù… PWM.",
        defaultCode:
`int led = 9;
void setup() { pinMode(led, OUTPUT); }
void loop() {
  for (int i=0;i<=255;i++){ analogWrite(led, i); delay(5); }
  for (int i=255;i>=0;i--){ analogWrite(led, i); delay(5); }
}
`,
        quiz: [
          { q: "Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© Ù„Ù€ analogWriteØŸ", choices: ["0-255", "0-1023"], answer: 0 },
          { q: "Ù‡Ù„ ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ± ØªØ¯Ø¹Ù… PWMØŸ", choices: ["Ù„Ø§", "Ù†Ø¹Ù…"], answer: 0 },
        ]
      },
      {
        id: 5,
        title: "Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª ÙˆØªØ£Ø®ÙŠØ± ØºÙŠØ± Ø­Ø§Ø¬Ø²",
        video: "lesson5.mp4",
        intro: "Ø§Ø³ØªØ®Ø¯Ù… millis Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† delay Ù„Ø¨Ù†Ø§Ø¡ Ù…Ù†Ø·Ù‚ ØºÙŠØ± Ø­Ø§Ø¬Ø² ÙŠØ³Ù…Ø­ Ø¨ØªÙ†ÙÙŠØ° Ù…Ù‡Ø§Ù… Ù…ØªØ¹Ø¯Ø¯Ø©.",
        defaultCode:
`unsigned long last = 0;
const unsigned long interval = 1000;
void setup(){ pinMode(LED_BUILTIN, OUTPUT); }
void loop(){
  unsigned long now = millis();
  if(now - last >= interval){
    last = now;
    digitalWrite(LED_BUILTIN, !digitalRead(LED_BUILTIN));
  }
}
`,
        quiz: [
          { q: "Ù…Ø§ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨ÙŠÙ† delay Ùˆ millisØŸ", choices: ["delay ÙŠØ­Ø¬Ø¨ Ø§Ù„ØªÙ†ÙÙŠØ°", "millis ÙŠØ­Ø¬Ø¨ Ø§Ù„ØªÙ†ÙÙŠØ°"], answer: 0 },
          { q: "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù…Ø¹ millisØŸ", choices: ["Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ©", "Ø«Ø§Ù†ÙŠØ©"], answer: 0 },
        ]
      },
      {
        id: 6,
        title: "Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ÙˆØ§Ù„ØªÙˆØ³Ø¹Ø§Øª",
        video: "lesson6.mp4",
        intro: "Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª Ø¹Ø¨Ø± Library Manager ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø­Ø±ÙƒØ§Øª.",
        defaultCode:
`// Ù…Ø«Ø§Ù„ Ù†Ø¸Ø±ÙŠ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø©
#include <Wire.h>
void setup(){ Wire.begin(); Serial.begin(9600); Serial.println("Ready"); }
void loop(){ /* ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ø¨Ø± I2C */ }
`,
        quiz: [
          { q: "Ø£ÙŠÙ† ØªØ¶ÙŠÙ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ÙÙŠ Arduino IDEØŸ", choices: ["Library Manager", "Board Manager"], answer: 0 },
          { q: "Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… SDA/SCLØŸ", choices: ["I2C", "SPI"], answer: 0 },
        ]
      },
      {
        id: 7,
        title: "Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø­Ø§Ø³ÙˆØ¨",
        video: "lesson7.mp4",
        intro: "Ø§Ù„ØªØ®Ø§Ø·Ø¨ Ø¹Ø¨Ø± Serial Ù…Ø¹ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.",
        defaultCode:
`void setup(){ Serial.begin(9600); }
void loop(){
  if(Serial.available()){
    char c = Serial.read();
    Serial.print("You typed: "); Serial.println(c);
  }
}
`,
        quiz: [
          { q: "Ù…Ø§ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªØ¹ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§ÙŠØªØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©ØŸ", choices: ["Serial.available()", "Serial.begin()"], answer: 0 },
          { q: "Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ù„Ø¨ÙˆØ¯ Ø±ÙŠØªØŸ", choices: ["9600", "1"], answer: 0 },
        ]
      },
      {
        id: 8,
        title: "Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø¤Ø§Ø²Ø±Ø© (Servo)",
        video: "lesson8.mp4",
        intro: "ØªØ­Ø±ÙŠÙƒ Ø³ÙŠØ±ÙÙˆ Ø¹Ø¨Ø± Ù…ÙƒØªØ¨Ø© Servo Ù„Ø²Ø§ÙˆÙŠØ§ Ù…Ø­Ø¯Ø¯Ø©.",
        defaultCode:
`#include <Servo.h>
Servo s;
void setup(){ s.attach(9); }
void loop(){
  for(int a=0; a<=180; a+=10){ s.write(a); delay(200); }
}
`,
        quiz: [
          { q: "Ù…Ø§ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù„Ù„Ø³ÙŠØ±ÙÙˆØŸ", choices: ["Servo", "Wire"], answer: 0 },
          { q: "Ù…Ø¯Ù‰ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ù…Ø¹ØªØ§Ø¯ Ù„Ù„Ø³ÙŠØ±ÙÙˆØŸ", choices: ["0-180", "0-360"], answer: 0 },
        ]
      },
      {
        id: 9,
        title: "Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ",
        video: "lesson9.mp4",
        intro: "Ù…Ù‚Ø¯Ù…Ø© Ø¹Ù† Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠØ© Ù…Ø«Ù„ NRF24L01 Ø£Ùˆ Ø¨Ù„ÙˆØªÙˆØ« HC-05.",
        defaultCode:
`// Ù…Ø«Ø§Ù„ ØªØµÙˆØ±ÙŠØŒ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
void setup(){ Serial.begin(9600); Serial.println("Wireless intro"); }
void loop(){ /* Ø¥Ø±Ø³Ø§Ù„/Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ */ }
`,
        quiz: [
          { q: "Ù…Ø§ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ù„Ù„Ø¨Ù„ÙˆØªÙˆØ« Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØŸ", choices: ["HC-05", "ESP-01"], answer: 0 },
          { q: "NRF24L01 ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ØŸ", choices: ["2.4GHz RF", "I2C ÙÙ‚Ø·"], answer: 0 },
        ]
      },
      {
        id: 10,
        title: "Ù…Ø´Ø±ÙˆØ¹ Ù…ØµØºØ±: Ù…Ø­Ø·Ø© Ø·Ù‚Ø³",
        video: "lesson10.mp4",
        intro: "Ø¬Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø§Øª Ø­Ø³Ø§Ø³Ø§Øª ÙˆØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙˆØ¹Ø±Ø¶Ù‡Ø§ Ø¹Ø¨Ø± Serialâ€”Ø£Ø³Ø§Ø³ÙŠØ§Øª Ù…Ø´Ø±ÙˆØ¹ Ù…Ø­Ø·Ø© Ø·Ù‚Ø³.",
        defaultCode:
`// Skeleton Ù„Ù…Ø­Ø·Ø© Ø·Ù‚Ø³
void setup(){ Serial.begin(9600); }
void loop(){
  int temp = 25; // Ù…Ø«Ø§Ù„
  int hum  = 60; // Ù…Ø«Ø§Ù„
  Serial.print("T: "); Serial.print(temp);
  Serial.print(" C, H: "); Serial.print(hum);
  Serial.println(" %");
  delay(1000);
}
`,
        quiz: [
          { q: "Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©ØŸ", choices: ["int Ø£Ùˆ float Ø­Ø³Ø¨ Ø§Ù„Ø­Ø³Ø§Ø³", "char"], answer: 0 },
          { q: "Ø§Ù„ØºØ±Ø¶ Ù…Ù† Serial.printØŸ", choices: ["Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ±"], answer: 0 },
        ]
      }
    ];

    // ========== 2) Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø±ÙˆØ³ ==========
    const lessonsList = document.getElementById('lessonsList');
    function renderHome(){
      lessonsList.innerHTML = '';
      lessons.forEach(ls => {
        const card = document.createElement('div');
        card.className = 'lesson-card';
        card.innerHTML = `
          <h3>ğŸ“ ${ls.title}</h3>
          <p class="muted">${ls.intro}</p>
          <div class="actions">
            <a class="nav-link" href="#/lesson/${ls.id}">Ø§ÙØªØ­ Ø§Ù„Ø¯Ø±Ø³</a>
            <span class="pill">Ø¯Ø±Ø³ Ø±Ù‚Ù… ${ls.id}</span>
          </div>
        `;
        lessonsList.appendChild(card);
      });
    }

    // ========== 3) Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¨Ø³ÙŠØ· Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§Ø´ ==========
    const homePage = document.getElementById('homePage');
    const lessonPage = document.getElementById('lessonPage');
    const lessonTitle = document.getElementById('lessonTitle');
    const lessonVideoSrc = document.getElementById('lessonVideoSrc');
    const lessonIntro = document.getElementById('lessonIntro');
    const lessonEditor = document.getElementById('lessonEditor');
    const lessonOutput = document.getElementById('lessonOutput');
    const lessonSavedAlert = document.getElementById('lessonSavedAlert');
    const quizContainer = document.getElementById('quizContainer');
    const quizResult = document.getElementById('quizResult');
    const notesArea = document.getElementById('notesArea');
    const notesSavedAlert = document.getElementById('notesSavedAlert');

    let currentLessonId = null;

    function setActiveNav(){
      document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
      const hash = location.hash || '#/';
      const match = document.querySelector(`.nav-link[href="${hash}"]`);
      if (match) match.classList.add('active');
    }

    function route(){
      const hash = location.hash || '#/';
      setActiveNav();
      if (hash === '#/' || hash === '#') {
        homePage.style.display = 'block';
        lessonPage.style.display = 'none';
        renderHome();
        return;
      }
      const m = hash.match(/^#\/lesson\/(\d+)$/);
      if (m){
        const id = parseInt(m[1], 10);
        const ls = lessons.find(x => x.id === id);
        if (!ls){ location.hash = '#/'; return; }
        currentLessonId = id;
        homePage.style.display = 'none';
        lessonPage.style.display = 'block';
        lessonTitle.textContent = `ğŸ“ ${ls.title}`;
        lessonVideoSrc.src = ls.video || '';
        document.getElementById('lessonVideo').load();
        lessonIntro.textContent = ls.intro;
        // Load editor content
        const savedCode = localStorage.getItem(`lesson-${id}-code`);
        lessonEditor.value = savedCode ?? ls.defaultCode;
        lessonOutput.textContent = '// Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...';
        // Notes
        const savedNotes = localStorage.getItem(`lesson-${id}-notes`);
        notesArea.value = savedNotes ?? '';
        // Quiz render
        renderQuiz(ls.quiz);
        const savedScore = localStorage.getItem(`lesson-${id}-quiz`);
        if (savedScore){
          quizResult.style.display = 'block';
          const {score, answered} = JSON.parse(savedScore);
          quizResult.textContent = `Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ${score}/${answered}`;
        } else {
          quizResult.style.display = 'none';
        }
      } else {
        location.hash = '#/';
      }
    }
    window.addEventListener('hashchange', route);
    route();

    // ========== 4) ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ (Ù…Ø­Ø§ÙƒØ§Ø© Serial.println) ==========
    document.getElementById('runLessonBtn').addEventListener('click', () => {
      const code = lessonEditor.value;
      const lines = [];
      const matches = code.match(/Serial\.println\((.*?)\);/g) || [];
      if (matches.length === 0) {
        lines.push('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Serial.println() ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.');
      } else {
        matches.forEach(m => {
          const inner = m.replace(/^Serial\.println\(/,'').replace(/\);\s*$/,'');
          try {
            const text = Function(`return (${inner})`)();
            lines.push(String(text));
          } catch {
            lines.push(inner);
          }
        });
      }
      lessonOutput.textContent = lines.length ? lines.join('\n') : 'â€”';
    });
    document.getElementById('resetLessonBtn').addEventListener('click', () => {
      const ls = lessons.find(x => x.id === currentLessonId);
      if (!ls) return;
      lessonEditor.value = ls.defaultCode;
      lessonOutput.textContent = '// Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...';
    });
    document.getElementById('saveLessonBtn').addEventListener('click', () => {
      if (!currentLessonId) return;
      try {
        localStorage.setItem(`lesson-${currentLessonId}-code`, lessonEditor.value);
        lessonSavedAlert.style.display = 'block';
        setTimeout(() => lessonSavedAlert.style.display = 'none', 2000);
      } catch {}
    });
    document.getElementById('clearLessonBtn').addEventListener('click', () => {
      if (!currentLessonId) return;
      localStorage.removeItem(`lesson-${currentLessonId}-code`);
      localStorage.removeItem(`lesson-${currentLessonId}-quiz`);
      localStorage.removeItem(`lesson-${currentLessonId}-notes`);
      lessonOutput.textContent = '// Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...';
      notesArea.value = '';
      quizResult.style.display = 'none';
    });

    // ========== 5) Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ==========
    document.getElementById('saveNotesBtn').addEventListener('click', () => {
      if (!currentLessonId) return;
      try {
        localStorage.setItem(`lesson-${currentLessonId}-notes`, notesArea.value);
        notesSavedAlert.style.display = 'block';
        setTimeout(() => notesSavedAlert.style.display = 'none', 2000);
      } catch {}
    });

    // ========== 6) Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù„ÙƒÙ„ Ø¯Ø±Ø³ ==========
    function renderQuiz(quiz){
      quizContainer.innerHTML = '';
      quiz.forEach((item, idx) => {
        const w = document.createElement('div');
        w.className = 'lesson-card';
        const buttons = item.choices.map((c, i) =>
          `<button class="${i===item.answer?'':'secondary'}" data-qi="${idx}" data-ci="${i}">${c}</button>`).join(' ');
        w.innerHTML = `<p><strong>Ø³Ø¤Ø§Ù„ ${idx+1}:</strong> ${item.q}</p><div class="btns">${buttons}</div>`;
        quizContainer.appendChild(w);
      });
      quizResult.style.display = 'none';
      let score = 0, answered = 0;
      quizContainer.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          const qi = parseInt(btn.dataset.qi, 10);
          const ci = parseInt(btn.dataset.ci, 10);
          const ls = lessons.find(x => x.id === currentLessonId);
          const correct = ls.quiz[qi].answer;
          if (ci === correct){
            score++;
            btn.classList.remove('secondary');
            btn.classList.add('success');
          } else {
            btn.classList.remove('secondary');
            btn.classList.add('danger');
          }
          // disable all buttons of this question
          quizContainer.querySelectorAll(`button[data-qi="${qi}"]`).forEach(b => b.disabled = true);
          answered++;
          quizResult.style.display = 'block';
          quizResult.textContent = `Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ ${answered} Ø³Ø¤Ø§Ù„(Ø§Ù‹) â€¢ Ù†ØªÙŠØ¬ØªÙƒ: ${score}/${answered}`;
          localStorage.setItem(`lesson-${currentLessonId}-quiz`, JSON.stringify({score, answered}));
        });
      });
    }

    // ========== 7) PWA: manifest Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù ==========
    const icon192 = generateIcon(192);
    const icon512 = generateIcon(512);
    const manifest = {
      name: "ØªØ¹Ù„Ù… Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ",
      short_name: "Arduino Learn",
      lang: "ar", dir: "rtl",
      start_url: ".",
      scope: ".",
      display: "standalone",
      theme_color: "#0aa2b8",
      background_color: "#0f121a",
      icons: [
        { src: icon192, sizes: "192x192", type: "image/png", purpose: "any" },
        { src: icon512, sizes: "512x512", type: "image/png", purpose: "any maskable" }
      ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/manifest+json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    const linkManifest = document.createElement('link');
    linkManifest.rel = 'manifest';
    linkManifest.href = manifestURL;
    document.head.appendChild(linkManifest);

    // ========== 8) Service Worker Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù ==========
    const swCode = `
      const CACHE_NAME = 'arduino-learn-v2';
      const APP_SHELL = ['./'];
      self.addEventListener('install', (event) => {
        event.waitUntil(
          caches.open(CACHE_NAME).then(cache => cache.addAll(APP_SHELL)).then(() => self.skipWaiting())
        );
      });
      self.addEventListener('activate', (event) => {
        event.waitUntil(
          caches.keys().then(keys => Promise.all(keys.map(k => k === CACHE_NAME ? null : caches.delete(k))))
        );
        self.clients.claim();
      });
      self.addEventListener('fetch', (event) => {
        const req = event.request;
        event.respondWith(
          caches.match(req).then(cached => {
            if (cached) return cached;
            return fetch(req).then(res => {
              const copy = res.clone();
              caches.open(CACHE_NAME).then(cache => {
                if (req.method === 'GET' && req.url.startsWith(self.location.origin)) {
                  cache.put(req, copy).catch(()=>{});
                }
              });
              return res;
            }).catch(() => {
              if (req.mode === 'navigate') {
                return new Response('<h1 style="font-family:sans-serif">Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„</h1><p>Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„.</p>', { headers: { 'Content-Type': 'text/html; charset=utf-8' } });
              }
            });
          })
        );
      });
    `;
    const swBlob = new Blob([swCode], { type: 'application/javascript' });
    const swURL = URL.createObjectURL(swBlob);
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register(swURL).catch(()=>{});
    }

    // ========== 9) Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª ==========
    let deferredPrompt = null;
    const banner = document.getElementById('installBanner');
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      banner.style.display = 'flex';
    });
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      await deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      banner.style.display = 'none';
      deferredPrompt = null;
    });

    // ========== 10) ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© ==========
    renderHome();
  </script>
</body>
</html>
